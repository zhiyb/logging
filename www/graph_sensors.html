<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" type="image/svg+xml" href="/boo_vector_art.svg">
<script>
// https://stackoverflow.com/a/5448595
function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    var items = location.search.substr(1).split("&");
    for (var index = 0; index < items.length; index++) {
        tmp = items[index].split("=");
        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
    }
    return result;
}
var hn = findGetParameter('h');
if (!hn)
  hn = "pico";
var t = "sensors";
</script>
<script>document.write(`<title>Logging graphs - ${t} - ${hn}</title>`);</script>
</head>
<body>
<h1><script>document.write(hn);</script></h1>
<div id="graph_sensors"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

<script type="module">
import * as cmn from "./functions.js";

let linkedZoom = [];

$.getJSON("get_sensor_types.php?h=" + hn, data => {
  let div = {};
  let e = $('#graph_sensors');
  for (const type of data) {
    div[type] = $(`<div><h2><a href="graph_sensor.html?h=${hn}&type=${type}">${type}</a></h2></div>`);
    e.append(div[type]);
    $.getJSON("get.php?h=" + hn + "&t=" + t + "&type=" + type, data => {
      if (!data.length)
        return;

      let values = [];
      for (let obj of data) {
        let ts = cmn.parse_ts(obj.ts);

        values.push({
          ts: ts,
          type: obj.sensor,
          val: obj.data === null ? NaN : +obj.data,
        });
      }

      cmn.add_chart(div[type], values, {
        x: d => d.ts,
        y: d => d.val,
        z: d => d.type,
        yLabel: "â†‘ " + cmn.get_sensor_unit(type),
        //dashed: true,
        width: 1024,
        height: 500,
        //curve: d3.curveMonotoneX,
        colors: [cmn.schemeTableau10[3], cmn.schemeTableau10[0]],
        mixBlendMode: "normal",
        linkedZoom: linkedZoom,
      });
    });
  }
});
</script>
</body>
</html>
